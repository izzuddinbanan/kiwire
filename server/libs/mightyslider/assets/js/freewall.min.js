// created by Minh Nguyen;
// version 1.04;
(function(k){null==k.isNumeric&&(k.isNumeric=function(b){return null!=b&&b.constructor===Number});null==k.isFunction&&(k.isFunction=function(b){return null!=b&&b instanceof Function});var w=k(window),x=k(document),l={defaultConfig:{animate:!1,cellW:100,cellH:100,delay:0,engine:"giot",fixSize:null,gutterX:15,gutterY:15,selector:"> div",draggable:!1,rightToLeft:!1,bottomToTop:!1,onGapFound:function(){},onComplete:function(){},onResize:function(){},onBlockReady:function(){},onBlockFinish:function(){},
onBlockActive:function(){}},plugin:{},totalGrid:1,transition:!1,loadBlock:function(b,h){var a=h.runtime,g=k(b),f=null,f=a.gutterX,e=a.gutterY,c=parseInt(g.attr("data-fixSize")),d=a.lastId++ +"-"+a.totalGrid;if(!g.hasClass("fw-float")){g.attr({id:d,"data-delay":b.index});h.animate&&this.transition&&this.setTransition(b,"");null==g.attr("data-height")&&g.attr("data-height",g.height());null==g.attr("data-width")&&g.attr("data-width",g.width());var q=1*g.attr("data-height"),n=1*g.attr("data-width"),s=
g.attr("data-position"),v=a.cellH,m=a.cellW,u=n?Math.round((n+f)/m):0,l=q?Math.round((q+e)/v):0;isNaN(c)&&(c=null);c||"auto"!=h.cellH||(g.width(m*u-f),b.style.height="",l=(q=g.height())?Math.round((q+e)/v):0);c||"auto"!=h.cellW||(g.height(v*l-e),b.style.width="",u=(n=g.width())?Math.round((n+f)/m):0);null!=c&&(u>a.limitCol||l>a.limitRow)?f=null:(l&&l<a.minHoB&&(a.minHoB=l),u&&u<a.minWoB&&(a.minWoB=u),l>a.maxHoB&&(a.maxHoB=l),u>a.maxWoB&&(a.maxWoB=u),0==n&&(u=0),0==q&&(l=0),f={id:d,width:u,height:l,
fixSize:c},s&&(s=s.split("-"),f.y=1*s[0],f.x=1*s[1],f.width=null!=c?u:Math.min(u,a.limitCol-f.x),f.height=null!=c?l:Math.min(l,a.limitRow-f.y),a.holes[f.y+"-"+f.x+"-"+f.width+"-"+f.height]={id:f.id,top:f.y,left:f.x,width:f.width,height:f.height},this.setBlock(f,h)));null==g.attr("data-state")?g.attr("data-state","init"):g.attr("data-state","move");h.onBlockReady.call(b,f,h);return s?null:f}},setBlock:function(b,h){var a=h.runtime,g=a.gutterX,f=a.gutterY,e=b.height,c=b.width,d=a.cellH,q=a.cellW,n=
b.x,s=b.y;h.rightToLeft&&(n=a.limitCol-n-c);h.bottomToTop&&(s=a.limitRow-s-e);g={fixSize:b.fixSize,top:s*d,left:n*q,width:q*c-g,height:d*e-f};g.top=1*g.top.toFixed(2);g.left=1*g.left.toFixed(2);g.width=1*g.width.toFixed(2);g.height=1*g.height.toFixed(2);b.id&&(a.blocks[b.id]=g);return g},showBlock:function(b,h){function a(){q&&c.attr("data-state","start");h.animate&&d.transition&&d.setTransition(b,n);if(e)e.fixSize&&(e.height=1*c.attr("data-height"),e.width=1*c.attr("data-width")),c.css({opacity:1,
width:e.width,height:e.height}),c[f]({top:e.top,left:e.left}),null!=c.attr("data-nested")&&d.nestedGrid(b,h);else{var a=parseInt(b.style.height)||0,l=parseInt(b.style.width)||0,m=parseInt(b.style.left)||0,k=parseInt(b.style.top)||0;c[f]({left:m+l/2,top:k+a/2,width:0,height:0,opacity:0})}g.length-=1;h.onBlockFinish.call(b,e,h);0==g.length&&h.onComplete.call(b,e,h)}var g=h.runtime,f=h.animate&&!this.transition?"animate":"css",e=g.blocks[b.id],c=k(b),d=this,q="move"!=c.attr("data-state"),n=q?"width 0.5s, height 0.5s":
"top 0.5s, left 0.5s, width 0.5s, height 0.5s, opacity 0.5s";b.delay&&clearTimeout(b.delay);c.hasClass("fw-float")||(d.setTransition(b,""),b.style.position="absolute",h.onBlockActive.call(b,e,h),0<h.delay?b.delay=setTimeout(a,h.delay*c.attr("data-delay")):a())},nestedGrid:function(b,h){var a;a=k(b);var g=h.runtime,f=a.attr("data-gutterX")||h.gutterX,e=a.attr("data-gutterY")||h.gutterY,c=a.attr("data-method")||"fitZone",d=a.attr("data-nested")||"> div",q=a.attr("data-cellH")||h.cellH,n=a.attr("data-cellW")||
h.cellW;if(g=g.blocks[b.id])switch(a=new freewall(a),a.reset({cellH:q,cellW:n,gutterX:1*f,gutterY:1*e,selector:d}),c){case "fitHeight":a[c](g.height);break;case "fitWidth":a[c](g.width);break;case "fitZone":a[c](g.width,g.height)}},adjustBlock:function(b,h){var a=h.runtime,g=a.gutterX,f=a.gutterY,e=k("#"+b.id),c=a.cellH,a=a.cellW;h.cellH="auto";e.width(b.width*a-g);e.get(0).style="";b.height=Math.round((e.height()+f)/c)},adjustUnit:function(b,h,a){var g=a.gutterX,f=a.gutterY,e=a.runtime,c=a.cellW;
a=a.cellH;k.isFunction(c)&&(c=c(b));c*=1;!k.isNumeric(c)&&(c=1);k.isFunction(a)&&(a=a(h));a*=1;!k.isNumeric(a)&&(a=1);if(k.isNumeric(b)){1>c&&(c*=b);var d=Math.max(1,Math.floor(b/c));k.isNumeric(g)||(g=(b-d*c)/Math.max(1,d-1),g=Math.max(0,g));d=Math.floor((b+g)/c);e.cellW=(b+g)/Math.max(d,1);e.cellS=e.cellW/c;e.gutterX=g;e.limitCol=d}k.isNumeric(h)&&(1>a&&(a*=h),d=Math.max(1,Math.floor(h/a)),k.isNumeric(f)||(f=(h-d*a)/Math.max(1,d-1),f=Math.max(0,f)),d=Math.floor((h+f)/a),e.cellH=(h+f)/Math.max(d,
1),e.cellS=e.cellH/a,e.gutterY=f,e.limitRow=d);k.isNumeric(b)||(1>c&&(c=e.cellH),e.cellW=1!=c?c*e.cellS:1,e.gutterX=g,e.limitCol=666666);k.isNumeric(h)||(1>a&&(a=e.cellW),e.cellH=1!=a?a*e.cellS:1,e.gutterY=f,e.limitRow=666666)},resetGrid:function(b){b.blocks={};b.length=0;b.cellH=0;b.cellW=0;b.lastId=1;b.matrix={};b.totalCol=0;b.totalRow=0},setDraggable:function(b,h){var a=!1,g={startX:0,startY:0,top:0,left:0,handle:null,onDrop:function(){},onDrag:function(){},onStart:function(){}};k(b).each(function(){function b(d){d=
d.originalEvent;a&&(d=d.changedTouches[0]);n.css({top:c.top-(c.startY-d.clientY),left:c.left-(c.startX-d.clientX)});c.onDrag.call(q,d)}function e(d){d=d.originalEvent;a&&(d=d.changedTouches[0]);c.onDrop.call(q,d);x.unbind("mouseup touchend",e);x.unbind("mousemove touchmove",b)}var c=k.extend({},g,h),d=c.handle||this,q=this,n=k(q),d=k(d);"absolute"!=n.css("position")&&n.css("position","relative");n.find("iframe, form, input, textarea, .ignore-drag").each(function(){k(this).on("touchstart mousedown",
function(a){a.stopPropagation()})});x.unbind("mouseup touchend",e);x.unbind("mousemove touchmove",b);d.unbind("mousedown touchstart").bind("mousedown touchstart",function(d){d.stopPropagation();d=d.originalEvent;d.touches&&(a=!0,d=d.changedTouches[0]);2!=d.button&&3!=d.which&&(c.onStart.call(q,d),c.startX=d.clientX,c.startY=d.clientY,c.top=parseInt(n.css("top"))||0,c.left=parseInt(n.css("left"))||0,x.bind("mouseup touchend",e),x.bind("mousemove touchmove",b));return!1})})},setTransition:function(b,
h){var a=b.style,g=k(b);!this.transition&&g.stop?g.stop():null!=a.webkitTransition?a.webkitTransition=h:null!=a.MozTransition?a.MozTransition=h:null!=a.msTransition?a.msTransition=h:null!=a.OTransition?a.OTransition=h:a.transition=h},getFreeArea:function(b,h,a){var g=Math.min(b+a.maxHoB,a.limitRow),f=Math.min(h+a.maxWoB,a.limitCol),e=f,c=g;a=a.matrix;for(var d=b;d<c;++d)for(var q=h;q<f;++q)a[d+"-"+q]&&h<q&&q<e&&(e=q);for(d=b;d<g;++d)for(q=h;q<e;++q)a[d+"-"+q]&&b<d&&d<c&&(c=d);return{top:b,left:h,
width:e-h,height:c-b}},setWallSize:function(b,h){var a=b.totalRow,g=b.totalCol,f=b.gutterY,e=b.cellH,c=Math.max(0,b.cellW*g-b.gutterX),f=Math.max(0,e*a-f);h.attr({"data-total-col":g,"data-total-row":a,"data-wall-width":Math.ceil(c),"data-wall-height":Math.ceil(f)});b.limitCol<b.limitRow&&!h.attr("data-height")&&h.height(Math.ceil(f))}},z={giot:function(b,h){function a(d,a,e,b,f){for(var g=a;g<a+f;){for(var c=e;c<e+b;)u[g+"-"+c]=d,++c>q&&(q=c);++g>n&&(n=g)}}var g=h.runtime,f=g.limitRow,e=g.limitCol,
c=0,d=0,q=g.totalCol,n=g.totalRow,s={},k=g.holes,m=null,u=g.matrix,A=Math.max(e,f),t=null,m=null,y=e<f?1:0,p=null,f=Math.min(e,f),r;for(r in k)k.hasOwnProperty(r)&&a(k[r].id||!0,k[r].top,k[r].left,k[r].width,k[r].height);for(k=0;k<A&&b.length;++k)for(y?d=k:c=k,p=null,e=0;e<f&&b.length;++e)if(y?c=e:d=e,!g.matrix[d+"-"+c]){t=l.getFreeArea(d,c,g);m=null;for(r=0;r<b.length;++r)if(!(b[r].height>t.height||b[r].width>t.width)){m=b.splice(r,1)[0];break}if(null==m&&null==h.fixSize)if(p&&!y&&g.minHoB>t.height){p.height+=
t.height;a(p.id,p.y,p.x,p.width,p.height);l.setBlock(p,h);continue}else if(p&&y&&g.minWoB>t.width){p.width+=t.width;a(p.id,p.y,p.x,p.width,p.height);l.setBlock(p,h);continue}else for(r=0;r<b.length;++r)if(null==b[r].fixSize){m=b.splice(r,1)[0];y?(m.width=t.width,"auto"==h.cellH&&l.adjustBlock(m,h),m.height=Math.min(m.height,t.height)):(m.height=t.height,m.width=Math.min(m.width,t.width));break}if(null!=m)s[m.id]={id:m.id,x:c,y:d,width:m.width,height:m.height,fixSize:m.fixSize},p=s[m.id],a(p.id,p.y,
p.x,p.width,p.height),l.setBlock(p,h);else{m={x:c,y:d,fixSize:0};if(y)for(m.width=t.width,m.height=0,t=c-1,r=d;u[r+"-"+t];)u[r+"-"+c]=!0,m.height+=1,r+=1;else for(m.height=t.height,m.width=0,r=d-1,t=c;u[r+"-"+t];)u[d+"-"+t]=!0,m.width+=1,t+=1;h.onGapFound(l.setBlock(m,h),h)}}g.matrix=u;g.totalRow=n;g.totalCol=q}};window.freewall=function(b){function h(d){var a=e.cellH,b=e.cellW,c=k(d),h=c.find(c.attr("data-handle"));l.setDraggable(d,{handle:h[0],onStart:function(a){f.animate&&l.transition&&l.setTransition(this,
"");c.css("z-index",9999).addClass("fw-float")},onDrag:function(d,f){var h=c.position(),k=Math.round(h.top/a),h=Math.round(h.left/b),l=Math.round(c.width()/b),p=Math.round(c.height()/a),k=Math.min(Math.max(0,k),e.limitRow-p),h=Math.min(Math.max(0,h),e.limitCol-l);g.setHoles({top:k,left:h,width:l,height:p});g.refresh()},onDrop:function(){var d=c.position(),f=Math.round(d.top/a),d=Math.round(d.left/b),h=Math.round(c.width()/b),l=Math.round(c.height()/a),f=Math.min(Math.max(0,f),e.limitRow-l),d=Math.min(Math.max(0,
d),e.limitCol-h);c.removeClass("fw-float");c.css({zIndex:"auto",top:f*a,left:d*b});var v,p,r;for(p=0;p<l;++p)for(v=0;v<h;++v)r=p+f+"-"+(v+d),(r=e.matrix[r])&&!0!=r&&k("#"+r).removeAttr("data-position");e.holes={};c.attr({"data-width":c.width(),"data-height":c.height(),"data-position":f+"-"+d});g.refresh()}})}var a=k(b);"static"==a.css("position")&&a.css("position","relative");b=Number.MAX_VALUE;var g=this;l.totalGrid+=1;var f=k.extend({},l.defaultConfig),e={blocks:{},events:{},matrix:{},holes:{},
cellW:0,cellH:0,cellS:1,filter:"",lastId:0,length:0,maxWoB:0,maxHoB:0,minWoB:b,minHoB:b,running:0,gutterX:15,gutterY:15,totalCol:0,totalRow:0,limitCol:666666,limitRow:666666,currentMethod:null,currentArguments:[]};f.runtime=e;e.totalGrid=l.totalGrid;b=document.body.style;l.transition||null==b.webkitTransition&&null==b.MozTransition&&null==b.msTransition&&null==b.OTransition&&null==b.transition||(l.transition=!0);k.extend(g,{addCustomEvent:function(d,a){var b=e.events;d=d.toLowerCase();!b[d]&&(b[d]=
[]);a.eid=b[d].length;b[d].push(a);return this},appendBlock:function(d){d=k(d).appendTo(a);var b=null,c=[];d.each(function(d,a){a.index=++d;(b=l.loadBlock(a,f))&&c.push(b)});z[f.engine](c,f);l.setWallSize(e,a);e.length=d.length;d.each(function(d,a){l.showBlock(a,f);(f.draggable||a.getAttribute("data-draggable"))&&h(a)})},appendHoles:function(d){d=[].concat(d);var a={},b;for(b=0;b<d.length;++b)a=d[b],e.holes[a.top+"-"+a.left+"-"+a.width+"-"+a.height]=a;return this},container:a,fillHoles:function(a){if(0==
arguments.length)e.holes={};else{var b=[].concat(a),c={},f;for(f=0;f<b.length;++f)c=b[f],e.holes[c.top+"-"+c.left+"-"+c.width+"-"+c.height]=null}return this},filter:function(a){e.filter=a;e.currentMethod&&this.refresh();return this},fireEvent:function(a,b,c){var f=e.events;a=a.toLowerCase();if(f[a]&&f[a].length)for(var g=0;g<f[a].length;++g)f[a][g].call(this,b,c);return this},fitHeight:function(d){var b=a.find(f.selector).removeAttr("id"),c=null,s=[];d=d?d:a.height()||w.height();e.currentMethod=arguments.callee;
e.currentArguments=arguments;l.resetGrid(e);l.adjustUnit("auto",d,f);e.filter?(b.data("active",0),b.filter(e.filter).data("active",1)):b.data("active",1);b.each(function(a,b){var d=k(b);b.index=++a;(c=l.loadBlock(b,f))&&d.data("active")&&s.push(c)});g.fireEvent("onGridReady",a,f);z[f.engine](s,f);l.setWallSize(e,a);g.fireEvent("onGridArrange",a,f);e.length=b.length;b.each(function(a,b){l.showBlock(b,f);(f.draggable||b.getAttribute("data-draggable"))&&h(b)})},fitWidth:function(b){var c=a.find(f.selector).removeAttr("id"),
n=null,s=[];b=b?b:a.width()||w.width();e.currentMethod=arguments.callee;e.currentArguments=arguments;l.resetGrid(e);l.adjustUnit(b,"auto",f);e.filter?(c.data("active",0),c.filter(e.filter).data("active",1)):c.data("active",1);c.each(function(a,b){var d=k(b);b.index=++a;(n=l.loadBlock(b,f))&&d.data("active")&&s.push(n)});g.fireEvent("onGridReady",a,f);z[f.engine](s,f);l.setWallSize(e,a);g.fireEvent("onGridArrange",a,f);e.length=c.length;c.each(function(a,b){l.showBlock(b,f);(f.draggable||b.getAttribute("data-draggable"))&&
h(b)})},fitZone:function(b,c){var n=a.find(f.selector).removeAttr("id"),s=null,v=[];c=c?c:a.height()||w.height();b=b?b:a.width()||w.width();e.currentMethod=arguments.callee;e.currentArguments=arguments;l.resetGrid(e);l.adjustUnit(b,c,f);e.filter?(n.data("active",0),n.filter(e.filter).data("active",1)):n.data("active",1);n.each(function(a,b){var d=k(b);b.index=++a;(s=l.loadBlock(b,f))&&d.data("active")&&v.push(s)});g.fireEvent("onGridReady",a,f);z[f.engine](v,f);l.setWallSize(e,a);g.fireEvent("onGridArrange",
a,f);e.length=n.length;n.each(function(a,b){l.showBlock(b,f);(f.draggable||b.getAttribute("data-draggable"))&&h(b)})},fixPos:function(a){k(a.block).attr({"data-position":a.top+"-"+a.left});return this},fixSize:function(a){null!=a.width&&k(a.block).attr({"data-width":a.width});null!=a.height&&k(a.block).attr({"data-height":a.height});return this},prepend:function(b){a.prepend(b);e.currentMethod&&this.refresh();return this},refresh:function(){var a=arguments.length?arguments:e.currentArguments;null==
e.currentMethod&&(e.currentMethod=this.fitWidth);e.currentMethod.apply(this,Array.prototype.slice.call(a,0));return this},reset:function(a){k.extend(f,a);return this},setHoles:function(a){a=[].concat(a);var b={},c;e.holes={};for(c=0;c<a.length;++c)b=a[c],e.holes[b.top+"-"+b.left+"-"+b.width+"-"+b.height]=b;return this},unFilter:function(){delete e.filter;this.refresh();return this}});a.attr("data-min-width",80*Math.floor(w.width()/80));for(var c in l.plugin)l.plugin.hasOwnProperty(c)&&l.plugin[c].call(g,
f,a);w.resize(function(){e.running||(e.running=1,setTimeout(function(){e.running=0;f.onResize.call(g,a)},122),a.attr("data-min-width",80*Math.floor(w.width()/80)))})};freewall.addConfig=function(b){k.extend(l.defaultConfig,b)};freewall.createEngine=function(b){k.extend(z,b)};freewall.createPlugin=function(b){k.extend(l.plugin,b)};freewall.getMethod=function(b){return l[b]}})(window.Zepto||window.jQuery);